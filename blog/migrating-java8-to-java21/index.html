<!doctype html><html lang=zh data-bs-theme=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=preconnect href=https://KMWY81ZWS3-dsn.algolia.net crossorigin><script src=/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg="></script><link rel=stylesheet href="/main.4a50cad2f3d612bacb2ccf902d3f56508cb014c07dc7f3dcdbf6bea1201df034ad2b9bbde75673c0d8330d175df434ff0bddb8cfcebd284dc97f52252144e4b4.css" integrity="sha512-SlDK0vPWErrLLM+QLT9WUIywFMB9x/Pc2/a+oSAd8DStK5u951ZzwNgzDRdd9DT/C924z869KE3Jf1IlIUTktA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://www.xlabs.club/blog/migrating-java8-to-java21/><link rel=canonical href=https://www.xlabs.club/blog/migrating-java8-to-java21/><title>从 Java 8 升级到 Java 21，踩坑记录、变更评估和工具介绍 — XLabs</title>
<meta name=description content="XLabs Club"><link rel=icon href=/favicon.ico sizes=32x32><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/manifest.webmanifest><meta property="og:title" content="从 Java 8 升级到 Java 21，踩坑记录、变更评估和工具介绍"><meta property="og:description" content="破坏性变更评估
在升级之前，可通过 jdeps 和 jdeprscan 先评估下是否有使用内部类和废弃 API，有一个总的概览。
jdeps 是 Java 自带的命令行工具，可以用来分析依赖关系和生成模块信息文件，这里我们只借用他的其中一项功能。
通过 jdeps --jdk-internals 检查是否有使用内部 API，以下例子显示使用了 sun.net.util.IPAddressUtil 这个 Java 内部工具类，会显示详细的源码类和 jar 包位置。
可以继续使用 Java 中的内部 API，OpenJDK Wiki 页面 Java Dependency Analysis Tool 推荐了某些常用 JDK 内部 API 的替换项。




  
  
    
  
  
$ jdeps -dotoutput <dot-file-dir> -jdkinternals <one-or-more-jar-files....>

$ jdeps --jdk-internals --multi-release 21 --class-path . target/*.jar
. -> java.base
   com.my.package.function.SecurityChecker -> sun.net.util.IPAddressUtil                         JDK internal API (java.base)

Warning: JDK internal APIs are unsupported and private to JDK implementation that are
subject to be removed or changed incompatibly and could break your application.
Please modify your code to eliminate dependence on any JDK internal APIs.
For the most recent update on JDK internal API replacements, please check:
https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool
"><meta property="og:type" content="article"><meta property="og:url" content="https://www.xlabs.club/blog/migrating-java8-to-java21/"><meta property="og:image" content="https://www.xlabs.club/cover.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-05-23T21:03:11+08:00"><meta property="article:modified_time" content="2024-09-13T09:24:37+08:00"><meta property="og:site_name" content="XLabs"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.xlabs.club/cover.png"><meta name=twitter:title content="从 Java 8 升级到 Java 21，踩坑记录、变更评估和工具介绍"><meta name=twitter:description content="破坏性变更评估
在升级之前，可通过 jdeps 和 jdeprscan 先评估下是否有使用内部类和废弃 API，有一个总的概览。
jdeps 是 Java 自带的命令行工具，可以用来分析依赖关系和生成模块信息文件，这里我们只借用他的其中一项功能。
通过 jdeps --jdk-internals 检查是否有使用内部 API，以下例子显示使用了 sun.net.util.IPAddressUtil 这个 Java 内部工具类，会显示详细的源码类和 jar 包位置。
可以继续使用 Java 中的内部 API，OpenJDK Wiki 页面 Java Dependency Analysis Tool 推荐了某些常用 JDK 内部 API 的替换项。




  
  
    
  
  
$ jdeps -dotoutput <dot-file-dir> -jdkinternals <one-or-more-jar-files....>

$ jdeps --jdk-internals --multi-release 21 --class-path . target/*.jar
. -> java.base
   com.my.package.function.SecurityChecker -> sun.net.util.IPAddressUtil                         JDK internal API (java.base)

Warning: JDK internal APIs are unsupported and private to JDK implementation that are
subject to be removed or changed incompatibly and could break your application.
Please modify your code to eliminate dependence on any JDK internal APIs.
For the most recent update on JDK internal API replacements, please check:
https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool
"><meta name=twitter:site content="@xlabs-club"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://www.xlabs.club/","name":"卫星实验室","position":1},{"@type":"ListItem","item":"https://www.xlabs.club/blog/","name":"Blog","position":2},{"@type":"ListItem","name":"从 Java 8 升级到 Java 21，踩坑记录、变更评估和工具介绍","position":3}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"BlogPosting","headline":"从 Java 8 升级到 Java 21，踩坑记录、变更评估和工具介绍","description":"","isPartOf":{"@id":"https://www.xlabs.club/blog/migrating-java8-to-java21/"},"mainEntityOfPage":{"@id":"https://www.xlabs.club/blog/migrating-java8-to-java21/"},"datePublished":"2024-05-23T21:03:11+08:00","dateModified":"2024-09-13T09:24:37+08:00","author":{"@type":"Organization","name":"XLabs Club","url":"https://www.xlabs.club/"},"publisher":{"@type":"Organization","name":"XLabs Club"}}]}</script><meta http-equiv=content-language content='zh-cn'></head><body class="single section blog" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><header class="navbar navbar-expand-lg"><div class=container-fluid><a class="navbar-brand me-auto me-lg-3" href=/>XLabs</a><div id=docsearch class=d-none tabindex=-1 aria-disabled=true></div><button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu"><svg class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>XLabs</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close><svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class=nav-link href=https://www.xlabs.club/docs/guides/introduction/>Docs</a></li><li class=nav-item><a class="nav-link active" href=https://www.xlabs.club/blog/ aria-current=true>Blog</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link mx-2 d-none d-lg-block" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button id=buttonColorMode class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type=button aria-label="Toggle theme"><svg data-bs-theme-value="dark" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg><svg data-bs-theme-value="light" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://github.com/xlabs-club/xlabs-club.github.io><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li></ul></div></div></div></header></div><div class="wrap container-fluid" role=document><div class=content><div class="container p-0"><article><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><div class=blog-header><h1>从 Java 8 升级到 Java 21，踩坑记录、变更评估和工具介绍</h1><p><small>2024年5月23日<span class="stretched-link position-relative reading-time text-nowrap" title="Estimated reading time"><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 7v5l3 3"/></svg>2&nbsp;minutes</span></small></p></div></div><div class="col-md-12 col-lg-10"><h2 id=破坏性变更评估>破坏性变更评估</h2><p>在升级之前，可通过 jdeps 和 jdeprscan 先评估下是否有使用内部类和废弃 API，有一个总的概览。</p><p>jdeps 是 Java 自带的命令行工具，可以用来分析依赖关系和生成模块信息文件，这里我们只借用他的其中一项功能。</p><p>通过 <code>jdeps --jdk-internals</code> 检查是否有使用内部 API，以下例子显示使用了 <code>sun.net.util.IPAddressUtil</code> 这个 Java 内部工具类，会显示详细的源码类和 jar 包位置。</p><p>可以继续使用 Java 中的内部 API，OpenJDK Wiki 页面 <a href=https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool>Java Dependency Analysis Tool</a> 推荐了某些常用 JDK 内部 API 的替换项。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> jdeps -dotoutput &lt;dot-file-dir&gt; -jdkinternals &lt;one-or-more-jar-files....&gt;
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> jdeps --jdk-internals --multi-release <span class=m>21</span> --class-path . target/*.jar
</span></span><span class=line><span class=cl><span class=go>. -&gt; java.base
</span></span></span><span class=line><span class=cl><span class=go>   com.my.package.function.SecurityChecker -&gt; sun.net.util.IPAddressUtil                         JDK internal API (java.base)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Warning: JDK internal APIs are unsupported and private to JDK implementation that are
</span></span></span><span class=line><span class=cl><span class=go>subject to be removed or changed incompatibly and could break your application.
</span></span></span><span class=line><span class=cl><span class=go>Please modify your code to eliminate dependence on any JDK internal APIs.
</span></span></span><span class=line><span class=cl><span class=go>For the most recent update on JDK internal API replacements, please check:
</span></span></span><span class=line><span class=cl><span class=go>https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool
</span></span></span></code></pre></div></figure></div><p>jdeprscan 也是 Java 自带分析工具，可查看是否使用了已弃用或已删除的 API。使用已弃用的 API 不是阻塞性问题，还能接着跑，但是建议替换掉。使用已删除的 API，那就彻底跑不起来了。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 了解自 Java <span class=m>8</span> 后弃用的具体 API
</span></span><span class=line><span class=cl><span class=gp>$</span> jdeprscan --release <span class=m>21</span> --list
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 加上 --for-removal ，列出已删除的 API
</span></span><span class=line><span class=cl><span class=gp>$</span> jdeprscan --release <span class=m>21</span> --list --for-removal
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>@Deprecated(since=&#34;9&#34;, forRemoval=true) class javax.security.cert.Certificate
</span></span></span><span class=line><span class=cl><span class=go>@Deprecated(since=&#34;9&#34;, forRemoval=true) class javax.security.cert.CertificateEncodingException
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>……
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>@Deprecated(since=&#34;18&#34;, forRemoval=true) void java.lang.Enum.finalize()
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>@Deprecated(since=&#34;17&#34;, forRemoval=true) void java.lang.System.setSecurityManager(java.lang.SecurityManager)
</span></span></span><span class=line><span class=cl><span class=go>@Deprecated(since=&#34;17&#34;, forRemoval=true) java.lang.SecurityManager java.lang.System.getSecurityManager()
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>@Deprecated(since=&#34;21&#34;, forRemoval=true) javax.management.MBeanServerConnection javax.management.remote.JMXConnector.getMBeanServerConnection(javax.security.auth.Subject)
</span></span></span></code></pre></div></figure></div><p>扫描自己的代码中是否有使用废弃 API：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 注意通过 --class-path 增加依赖的 jar 包
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> jdeprscan --release <span class=m>21</span> --class-path log4j-api-2.13.0.jar my-application.jar
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>error: cannot find class sun/misc/BASE64Encoder
</span></span></span><span class=line><span class=cl><span class=go>class com/company/Util uses deprecated method java/lang/Double::&lt;init&gt;(D)V
</span></span></span></code></pre></div></figure></div><p>以上例子，com.company.Util 类在调用 java.lang.Double 类的已弃用构造函数。 javadoc 会建议用来代替已弃用 API 的 API。 但是无法解决“error: cannot find class sun/misc/BASE64Encoder”问题，因为它是已删除的 API， 自 Java 8 发布以来，应使用 java.util.Base64。</p><p>注意使用 jdeprscan 需要通过 &ndash;class-path 指定依赖项，可先执行 <code>mvn dependency:copy-dependencies</code> 命令，此时会 copy 依赖项到 <code>target/dependency</code> 目录。</p><p>另外，可在你项目的 maven pom 文件中引入 <code>maven-jdeps-plugin</code>，如下示例，引入后如果有使用废弃 API，将在 <code>mvn package</code> 的时候直接失败报错，避免有人无意引入废弃 API。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;project&gt;</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl>  <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>maven-jdeps-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>3.1.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;goal&gt;</span>jdkinternals<span class=nt>&lt;/goal&gt;</span> <span class=c>&lt;!-- verify main classes --&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;goal&gt;</span>test-jdkinternals<span class=nt>&lt;/goal&gt;</span> <span class=c>&lt;!-- verify test classes --&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;multiRelease&gt;</span>21<span class=nt>&lt;/multiRelease&gt;</span>
</span></span><span class=line><span class=cl>          ...
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl><span class=nt>&lt;/project&gt;</span></span></span></code></pre></div></figure></div><h2 id=易踩坑破坏性变更>易踩坑破坏性变更</h2><h2 id=辅助迁移工具>辅助迁移工具</h2><p><a href=https://github.com/adoptium/emt4j>Eclipse Migration Toolkit for Java (EMT4J)</a></p><p>EMT4J 也是一个静态分析工具，可输出分析报告，也可直接 apply 到 git。</p><p>目前发布比较慢，只有 master 分支支持 Java 21，可以基于 master 分支自己编译构建，也可以使用已 Realease 版本只分析到 Java 17。</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 以下示例自己编译构建，master 分支还不太稳定，可能出错
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> git clone git@github.com:adoptium/emt4j.git
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>cd</span> emt4j
</span></span><span class=line><span class=cl><span class=gp>$</span> mvn clean package -Prelease
</span></span><span class=line><span class=cl><span class=gp>#</span> 以上步骤生成 emt4j-<span class=si>${</span><span class=nv>version</span><span class=si>}</span>.zip 在 emt4j-assembly/target 目录下。
</span></span><span class=line><span class=cl><span class=gp>#</span> 解压以上 zip 后，得到
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>emt4j tree -L 2
</span></span></span><span class=line><span class=cl><span class=go>.
</span></span></span><span class=line><span class=cl><span class=go>├── bin
</span></span></span><span class=line><span class=cl><span class=go>│   ├── analysis.bat
</span></span></span><span class=line><span class=cl><span class=go>│   └── analysis.sh
</span></span></span><span class=line><span class=cl><span class=go>└── lib
</span></span></span><span class=line><span class=cl><span class=go>    ├── agent
</span></span></span><span class=line><span class=cl><span class=go>    ├── analysis
</span></span></span><span class=line><span class=cl><span class=go>    └── maven-plugin
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 注意 emt4j 需要使用 Java <span class=m>8</span> 运行，所以先把自己的 Java 环境切换到 Java <span class=m>8</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> sh bin/analysis.sh -f <span class=m>8</span> -t <span class=m>17</span> -o report.html my-java-project-dir
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> 在 report.html 能看到分析内容和建议，如
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Issues Context
</span></span></span><span class=line><span class=cl><span class=go>Location: refclass:file:my-java-project-dir/target/classes/com/mypackage/spring/BaseAbstractDataSource.class!/com.mypackage.spring.BaseAbstractDataSource!/, Target: java.lang.Class.newInstance()Ljava/lang/Object;
</span></span></span></code></pre></div></figure></div><p><a href=https://docs.openrewrite.org/>OpenRewrite</a>: 一键升级依赖包，重构源码，入门指导可参考我的另一篇博客：<a href=https://www.xlabs.club/docs/platform/smart-code/>智能代码重构</a>。 OpenRewrite 更成熟易用。</p><p><a href=https://jacoline.dev/inspect>JaCoLine</a>: 检查 Java 命令行选项的问题，识别出已经过时不支持的参数。</p><h2 id=遇见问题和解决办法>遇见问题和解决办法</h2><h2 id=参考资料>参考资料</h2><ul><li><p>Microsoft transition from java 8 to java 11</p><p><a href=https://learn.microsoft.com/en-us/java/openjdk/transition-from-java-8-to-java-11>https://learn.microsoft.com/en-us/java/openjdk/transition-from-java-8-to-java-11</a></p></li><li><p>Java Dependency Analysis Tool</p><p><a href=https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool>https://wiki.openjdk.org/display/JDK8/Java+Dependency+Analysis+Tool</a></p></li><li><p>Oracle Migrating From JDK 8 to Later JDK Releases</p><p><a href=https://docs.oracle.com/en/java/javase/21/migrate/migrating-jdk-8-later-jdk-releases.html#GUID-7744EF96-5899-4FB2-B34E-86D49B2E89B6>https://docs.oracle.com/en/java/javase/21/migrate/migrating-jdk-8-later-jdk-releases.html#GUID-7744EF96-5899-4FB2-B34E-86D49B2E89B6</a></p></li><li><p>什么是多版本 Jar（Multi Release Jar）</p><p><a href=https://docs.oracle.com/en/java/javase/11/docs/specs/jar/jar.html#multi-release-jar-files>https://docs.oracle.com/en/java/javase/11/docs/specs/jar/jar.html#multi-release-jar-files</a></p></li><li><p>Java G1 重要参数设置参考</p><p><a href=https://gceasy.io/gc-recommendations/important-g1-gc-arguments.jsp>https://gceasy.io/gc-recommendations/important-g1-gc-arguments.jsp</a></p></li></ul></div></div></article></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/>Powered by Hugo, and based on Doks</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item>Give Me a <a class=text-muted href=https://github.com/xlabs-club/>Star</a></li></ul></div></div></div></footer><script async src=/js/bootstrap.c673c84373e66019f7895efc74b3b3b940071832aaa8a85e73218087d535e71b.js integrity="sha256-xnPIQ3PmYBn3iV78dLOzuUAHGDKqqKhecyGAh9U15xs="></script><script async src=/js/app.e7bdedbe3e93c380c5129963c59b52f5356a936fec9e8cc00200854c72758ea6.js integrity="sha256-573tvj6Tw4DFEpljxZtS9TVqk2/snozAAgCFTHJ1jqY="></script><script async src=/js/docsearch.ade5067824e930be2f45872d695b6f30c95db2270f4859459b115527621f4874.js integrity="sha256-reUGeCTpML4vRYctaVtvMMldsicPSFlFmxFVJ2IfSHQ="></script></body></html>