<!doctype html><html lang=en data-bs-theme=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.xlabs.club/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=preconnect href=https://KMWY81ZWS3-dsn.algolia.net crossorigin><script src=/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg="></script><link rel=stylesheet href=/main.2aa5335cee60a9df953606d981be5d3bef2c11c1bb63b8a1adca2daeaa34638efbddf90c070f0a73b0de86940e7c842295e72a4d45bb5a9387f2f154e5d29d09.css integrity="sha512-KqUzXO5gqd+VNgbZgb5dO+8sEcG7Y7ihrcotrqo0Y4773fkMBw8Kc7DehpQOfIQilecqTUW7WpOH8vFU5dKdCQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://www.xlabs.club/docs/cloud/%E5%9F%BA%E4%BA%8E-envoy-%E7%9A%84%E6%99%BA%E8%83%BD%E8%B7%AF%E7%94%B1%E6%9C%8D%E5%8A%A1/><link rel=canonical href=https://www.xlabs.club/docs/cloud/%E5%9F%BA%E4%BA%8E-envoy-%E7%9A%84%E6%99%BA%E8%83%BD%E8%B7%AF%E7%94%B1%E6%9C%8D%E5%8A%A1/><title>基于 Envoy 的智能路由服务 — Doks</title>
<meta name=description content="Congrats on setting up a new Doks project!"><link rel=icon href=/favicon-16x16.png sizes=16x16 type=image/png><link rel=icon href=/favicon-32x32.png sizes=32x32 type=image/png><link rel=icon href=/favicon-150x150.png sizes=150x150 type=image/png><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=icon href=/favicon.svg><link rel=mask-icon href=/mask-icon.svg color=white><meta property="og:title" content="基于 Envoy 的智能路由服务"><meta property="og:description" content="基于 Envoy + Java Agent 的智能路由服务实现方案介绍。
核心需求 服务自动注册和发现，通过 Service Name 直接调用服务。当然基本的负载均衡策略、熔断降级限流等功能也要支持。 公司约定的路由策略，支持按照租户路由到特定环境的服务，比如 VIP、Gray、Sandbox 等。 多集群通信，同云内新老 K8S 集群路由打通，可通过 POD IP 互相通信。 跨云通信，支持通过 VPN 或代理，从专属云访问公有云服务。 整体架构 智能路由服务从逻辑上分为数据平面和控制平面，主要包含以下组件。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.xlabs.club/docs/cloud/%E5%9F%BA%E4%BA%8E-envoy-%E7%9A%84%E6%99%BA%E8%83%BD%E8%B7%AF%E7%94%B1%E6%9C%8D%E5%8A%A1/"><meta property="og:image" content="https://www.xlabs.club/cover.png"><meta property="article:section" content="docs"><meta property="article:published_time" content="2023-08-07T10:54:37+08:00"><meta property="article:modified_time" content="2023-08-07T10:54:37+08:00"><meta property="og:site_name" content="My Docs"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.xlabs.club/cover.png"><meta name=twitter:title content="基于 Envoy 的智能路由服务"><meta name=twitter:description content="基于 Envoy + Java Agent 的智能路由服务实现方案介绍。
核心需求 服务自动注册和发现，通过 Service Name 直接调用服务。当然基本的负载均衡策略、熔断降级限流等功能也要支持。 公司约定的路由策略，支持按照租户路由到特定环境的服务，比如 VIP、Gray、Sandbox 等。 多集群通信，同云内新老 K8S 集群路由打通，可通过 POD IP 互相通信。 跨云通信，支持通过 VPN 或代理，从专属云访问公有云服务。 整体架构 智能路由服务从逻辑上分为数据平面和控制平面，主要包含以下组件。"><meta name=twitter:site content="@getdoks"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://www.xlabs.club/","name":"Build an Amazing Docs Site","position":1},{"@type":"ListItem","item":"https://www.xlabs.club/docs/","name":"Docs","position":2},{"@type":"ListItem","item":"https://www.xlabs.club/docs/cloud/","name":"云原生","position":3},{"@type":"ListItem","name":"基于 Envoy 的智能路由服务","position":4}]}</script><script defer data-domain=getdoks.org src=https://plausible.io/js/script.js></script><meta name=bytedance-verification-code content="MLvJvgu8eINfBcFxGCcQ"></head><body class="single section docs" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><header class="navbar navbar-expand-lg"><div class=container-fluid><a class="navbar-brand me-auto me-lg-3" href=/><span class=visually-hidden>Doks</span><svg class="doks-images-light-mode svg-inline svg-inline-custom svg-lightmode" height="100%" width="70" viewBox="0 0 682 190" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M.616001 187V.375992H88.424c21.163.0 38.912 3.925338 53.248 11.776008 14.507 7.68 25.429 18.5173 32.768 32.512C181.949 58.6587 185.704 75.0427 185.704 93.816c0 19.968-4.011 36.864-12.032 50.688-7.851 13.824-19.029 24.405-33.536 31.744C125.629 183.416 108.392 187 88.424 187H.616001zM38.248 157.304H81.512c22.357.0 38.912-5.71700000000001 49.664-17.152 10.923-11.435 16.384-27.136 16.384-47.104.0-21.8453-6.059-37.8027-18.176-47.872-11.947-10.24-27.904-15.36-47.872-15.36H38.248V157.304zM281.82 189.56C265.777 189.56 251.697 186.744 239.58 181.112 227.463 175.48 217.991 167.373 211.164 156.792 204.508 146.211 201.18 133.581 201.18 118.904S204.508 91.6827 211.164 81.272C217.82 70.6907 227.207 62.584 239.324 56.952c12.117-5.8027 26.283-8.704 42.496-8.704 16.213.0 30.379 2.816 42.496 8.448C336.433 62.328 345.82 70.4347 352.476 81.016 359.132 91.4267 362.46 104.056 362.46 118.904 362.46 133.411 359.132 145.955 352.476 156.536s-16.043 18.773-28.16 24.576C312.369 186.744 298.204 189.56 281.82 189.56zm0-28.16c13.824.0 24.661-3.84 32.512-11.52s11.776-18.005 11.776-30.976C326.108 105.763 322.183 95.4373 314.332 87.928 306.652 80.248 295.815 76.408 281.82 76.408c-13.824.0-24.661 3.84-32.512 11.52C241.628 95.608 237.788 105.933 237.788 118.904S241.628 142.2 249.308 149.88C257.159 157.56 267.996 161.4 281.82 161.4zM384.068 187V.375992H420.42V110.2l17.152-15.36L490.82 50.808h46.336l-64.768 53.504L539.46 187H494.148l-38.656-48.64L446.02 125.56l-25.6 20.736V187H384.068zm227.244 2.56c-22.699.0-40.107-4.096-52.224-12.288C546.971 169.08 540.485 157.987 539.632 143.992H575.216c1.024 15.36 13.397 23.04 37.12 23.04C622.747 167.032 630.939 165.667 636.912 162.936 642.885 160.035 645.872 155.512 645.872 149.368 645.872 144.76 644.763 141.347 642.544 139.128 640.325 136.739 636.571 134.947 631.28 133.752 625.989 132.557 618.651 131.533 609.264 130.68 593.733 129.144 581.189 127.011 571.632 124.28 562.075 121.379 555.077 117.283 550.64 111.992 546.373 106.701 544.24 99.6187 544.24 90.744 544.24 77.7733 550.128 67.448 561.904 59.768c11.947-7.68 28.501-11.52 49.664-11.52C631.195 48.248 646.811 52.0027 658.416 59.512 670.021 67.0213 676.421 77.688 677.616 91.512H643.056C642.373 84.344 639.131 79.0533 633.328 75.64 627.525 72.2267 620.187 70.52 611.312 70.52 601.925 70.52 594.245 71.9707 588.272 74.872 582.469 77.6027 579.568 81.9547 579.568 87.928 579.568 93.9013 582.469 97.912 588.272 99.96 594.075 102.008 603.547 103.715 616.688 105.08 632.389 106.445 645.019 108.579 654.576 111.48 664.133 114.211 671.045 118.392 675.312 124.024 679.579 129.485 681.712 137.165 681.712 147.064c0 12.8-5.803 23.125-17.408 30.976C652.869 185.72 635.205 189.56 611.312 189.56z" fill="#1d2d35"/></svg><svg class="doks-images-dark-mode svg-inline svg-inline-custom svg-darkmode" height="100%" width="70" viewBox="0 0 682 190" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M.616001 187V.375992H88.424c21.163.0 38.912 3.925338 53.248 11.776008 14.507 7.68 25.429 18.5173 32.768 32.512C181.949 58.6587 185.704 75.0427 185.704 93.816c0 19.968-4.011 36.864-12.032 50.688-7.851 13.824-19.029 24.405-33.536 31.744C125.629 183.416 108.392 187 88.424 187H.616001zM38.248 157.304H81.512c22.357.0 38.912-5.71700000000001 49.664-17.152 10.923-11.435 16.384-27.136 16.384-47.104.0-21.8453-6.059-37.8027-18.176-47.872-11.947-10.24-27.904-15.36-47.872-15.36H38.248V157.304zM281.82 189.56C265.777 189.56 251.697 186.744 239.58 181.112 227.463 175.48 217.991 167.373 211.164 156.792 204.508 146.211 201.18 133.581 201.18 118.904S204.508 91.6827 211.164 81.272C217.82 70.6907 227.207 62.584 239.324 56.952c12.117-5.8027 26.283-8.704 42.496-8.704 16.213.0 30.379 2.816 42.496 8.448C336.433 62.328 345.82 70.4347 352.476 81.016 359.132 91.4267 362.46 104.056 362.46 118.904 362.46 133.411 359.132 145.955 352.476 156.536s-16.043 18.773-28.16 24.576C312.369 186.744 298.204 189.56 281.82 189.56zm0-28.16c13.824.0 24.661-3.84 32.512-11.52s11.776-18.005 11.776-30.976C326.108 105.763 322.183 95.4373 314.332 87.928 306.652 80.248 295.815 76.408 281.82 76.408c-13.824.0-24.661 3.84-32.512 11.52C241.628 95.608 237.788 105.933 237.788 118.904S241.628 142.2 249.308 149.88C257.159 157.56 267.996 161.4 281.82 161.4zM384.068 187V.375992H420.42V110.2l17.152-15.36L490.82 50.808h46.336l-64.768 53.504L539.46 187H494.148l-38.656-48.64L446.02 125.56l-25.6 20.736V187H384.068zm227.244 2.56c-22.699.0-40.107-4.096-52.224-12.288C546.971 169.08 540.485 157.987 539.632 143.992H575.216c1.024 15.36 13.397 23.04 37.12 23.04C622.747 167.032 630.939 165.667 636.912 162.936 642.885 160.035 645.872 155.512 645.872 149.368 645.872 144.76 644.763 141.347 642.544 139.128 640.325 136.739 636.571 134.947 631.28 133.752 625.989 132.557 618.651 131.533 609.264 130.68 593.733 129.144 581.189 127.011 571.632 124.28 562.075 121.379 555.077 117.283 550.64 111.992 546.373 106.701 544.24 99.6187 544.24 90.744 544.24 77.7733 550.128 67.448 561.904 59.768c11.947-7.68 28.501-11.52 49.664-11.52C631.195 48.248 646.811 52.0027 658.416 59.512 670.021 67.0213 676.421 77.688 677.616 91.512H643.056C642.373 84.344 639.131 79.0533 633.328 75.64 627.525 72.2267 620.187 70.52 611.312 70.52 601.925 70.52 594.245 71.9707 588.272 74.872 582.469 77.6027 579.568 81.9547 579.568 87.928 579.568 93.9013 582.469 97.912 588.272 99.96 594.075 102.008 603.547 103.715 616.688 105.08 632.389 106.445 645.019 108.579 654.576 111.48 664.133 114.211 671.045 118.392 675.312 124.024 679.579 129.485 681.712 137.165 681.712 147.064c0 12.8-5.803 23.125-17.408 30.976C652.869 185.72 635.205 189.56 611.312 189.56z" fill="#fff"/></svg></a><div id=docsearch class=d-none tabindex=-1 aria-disabled=true></div><button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button>
<button class="btn btn-link d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavSection aria-controls=offcanvasNavSection aria-label="Open section navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasNavSection aria-labelledby=offcanvasNavSectionLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavSectionLabel>Docs</h5><button type=button class="btn btn-link nav-link p-0" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-3d977af6029800a1bd3629ad45cccea2 aria-expanded=false>
平台工程</button><div class=collapse id=section-3d977af6029800a1bd3629ad45cccea2><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/platform/%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/>总体架构</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/platform/%E7%BB%9F%E4%B8%80%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/>统一身份认证</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/platform/%E5%BC%80%E5%8F%91%E8%80%85%E9%97%A8%E6%88%B7/>开发者门户</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/platform/%E6%99%BA%E8%83%BD%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84/>智能代码重构</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-03eadd6d06506d54fb81026b2f5963c8 aria-expanded=true>
云原生</button><div class="collapse show" id=section-03eadd6d06506d54fb81026b2f5963c8><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/cloud/introduction/>Introduction</a></li><li><a class="docs-link rounded active" href=https://www.xlabs.club/docs/cloud/%E5%9F%BA%E4%BA%8E-envoy-%E7%9A%84%E6%99%BA%E8%83%BD%E8%B7%AF%E7%94%B1%E6%9C%8D%E5%8A%A1/>基于 Envoy 的智能路由服务</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-d52387880e1ea22817a72d3759213819 aria-expanded=false>
Java</button><div class=collapse id=section-d52387880e1ea22817a72d3759213819><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/java/%E4%BB%8E-spring-%E5%88%B0-spring-boot/>从 Spring 到 Spring Boot</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/java/spring-boot-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/>Spring Boot 自定义监控指标</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/java/%E4%BD%BF%E7%94%A8-openrewrite-%E8%BF%9B%E8%A1%8C%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84/>使用 OpenRewrite 进行代码重构</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-71bb54bbe3fa573fa0200737b4296024 aria-expanded=false>
Start Here</button><div class=collapse id=section-71bb54bbe3fa573fa0200737b4296024><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/start-here/getting-started/>Getting Started</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/start-here/environmental-impact/>Environmental Impact</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/start-here/upgrade-to-v1/>Upgrade to v1</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-bbc9105ee8508ce6e083a589a351e83a aria-expanded=false>
Basics</button><div class=collapse id=section-bbc9105ee8508ce6e083a589a351e83a><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/basics/project-structure/>Project Structure</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/basics/authoring-content/>Authoring Content</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/basics/shortcodes/>Shortcodes</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/basics/navigation/>Navigation</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-7efb9866cc6ad242061889b460ca0bfd aria-expanded=false>
Built-ins</button><div class=collapse id=section-7efb9866cc6ad242061889b460ca0bfd><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/built-ins/math/>Mathematical Expressions</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/built-ins/diagrams/>Diagrams</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/built-ins/code-blocks/>Code Blocks</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-0153a1e369e543364edb1e75ceff1173 aria-expanded=false>
Recipes</button><div class=collapse id=section-0153a1e369e543364edb1e75ceff1173><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/recipes/deploy/>Deploy</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/recipes/analytics/>Analytics</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/recipes/cms/>CMS</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/recipes/docsearch/>DocSearch</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/recipes/versioning/>Versioning</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-45389ee90014e0938cb09409b9a8794d aria-expanded=false>
Guides</button><div class=collapse id=section-45389ee90014e0938cb09409b9a8794d><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/tldr/>TL;DR</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/customization/>Customizing Doks</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/styles/>Styles</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/scripts/>Scripts</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/layouts/>Layouts</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/i18n/>Internationalization (i18n)</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/%E4%BB%8E-1024-%E5%88%B0-512/>从 1024 到 512</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-63d5049791d9d79d86e9a108b0a999ca aria-expanded=false>
Reference</button><div class=collapse id=section-63d5049791d9d79d86e9a108b0a999ca><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/reference/configuration/>Configuration</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/reference/frontmatter/>Frontmatter</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/reference/markdown-basic-syntax/>Markdown Basic Syntax</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/reference/markdown-extended-syntax/>Markdown Extended Syntax</a></li></ul></div></li></ul></nav></aside></div></div><button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel><span class=visually-hidden>Doks</span><svg class="doks-images-light-mode svg-inline svg-inline-custom svg-lightmode" height="100%" width="60" viewBox="0 0 682 190" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M.616001 187V.375992H88.424c21.163.0 38.912 3.925338 53.248 11.776008 14.507 7.68 25.429 18.5173 32.768 32.512C181.949 58.6587 185.704 75.0427 185.704 93.816c0 19.968-4.011 36.864-12.032 50.688-7.851 13.824-19.029 24.405-33.536 31.744C125.629 183.416 108.392 187 88.424 187H.616001zM38.248 157.304H81.512c22.357.0 38.912-5.71700000000001 49.664-17.152 10.923-11.435 16.384-27.136 16.384-47.104.0-21.8453-6.059-37.8027-18.176-47.872-11.947-10.24-27.904-15.36-47.872-15.36H38.248V157.304zM281.82 189.56C265.777 189.56 251.697 186.744 239.58 181.112 227.463 175.48 217.991 167.373 211.164 156.792 204.508 146.211 201.18 133.581 201.18 118.904S204.508 91.6827 211.164 81.272C217.82 70.6907 227.207 62.584 239.324 56.952c12.117-5.8027 26.283-8.704 42.496-8.704 16.213.0 30.379 2.816 42.496 8.448C336.433 62.328 345.82 70.4347 352.476 81.016 359.132 91.4267 362.46 104.056 362.46 118.904 362.46 133.411 359.132 145.955 352.476 156.536s-16.043 18.773-28.16 24.576C312.369 186.744 298.204 189.56 281.82 189.56zm0-28.16c13.824.0 24.661-3.84 32.512-11.52s11.776-18.005 11.776-30.976C326.108 105.763 322.183 95.4373 314.332 87.928 306.652 80.248 295.815 76.408 281.82 76.408c-13.824.0-24.661 3.84-32.512 11.52C241.628 95.608 237.788 105.933 237.788 118.904S241.628 142.2 249.308 149.88C257.159 157.56 267.996 161.4 281.82 161.4zM384.068 187V.375992H420.42V110.2l17.152-15.36L490.82 50.808h46.336l-64.768 53.504L539.46 187H494.148l-38.656-48.64L446.02 125.56l-25.6 20.736V187H384.068zm227.244 2.56c-22.699.0-40.107-4.096-52.224-12.288C546.971 169.08 540.485 157.987 539.632 143.992H575.216c1.024 15.36 13.397 23.04 37.12 23.04C622.747 167.032 630.939 165.667 636.912 162.936 642.885 160.035 645.872 155.512 645.872 149.368 645.872 144.76 644.763 141.347 642.544 139.128 640.325 136.739 636.571 134.947 631.28 133.752 625.989 132.557 618.651 131.533 609.264 130.68 593.733 129.144 581.189 127.011 571.632 124.28 562.075 121.379 555.077 117.283 550.64 111.992 546.373 106.701 544.24 99.6187 544.24 90.744 544.24 77.7733 550.128 67.448 561.904 59.768c11.947-7.68 28.501-11.52 49.664-11.52C631.195 48.248 646.811 52.0027 658.416 59.512 670.021 67.0213 676.421 77.688 677.616 91.512H643.056C642.373 84.344 639.131 79.0533 633.328 75.64 627.525 72.2267 620.187 70.52 611.312 70.52 601.925 70.52 594.245 71.9707 588.272 74.872 582.469 77.6027 579.568 81.9547 579.568 87.928 579.568 93.9013 582.469 97.912 588.272 99.96 594.075 102.008 603.547 103.715 616.688 105.08 632.389 106.445 645.019 108.579 654.576 111.48 664.133 114.211 671.045 118.392 675.312 124.024 679.579 129.485 681.712 137.165 681.712 147.064c0 12.8-5.803 23.125-17.408 30.976C652.869 185.72 635.205 189.56 611.312 189.56z" fill="#1d2d35"/></svg><svg class="doks-images-dark-mode svg-inline svg-inline-custom svg-darkmode" height="100%" width="60" viewBox="0 0 682 190" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M.616001 187V.375992H88.424c21.163.0 38.912 3.925338 53.248 11.776008 14.507 7.68 25.429 18.5173 32.768 32.512C181.949 58.6587 185.704 75.0427 185.704 93.816c0 19.968-4.011 36.864-12.032 50.688-7.851 13.824-19.029 24.405-33.536 31.744C125.629 183.416 108.392 187 88.424 187H.616001zM38.248 157.304H81.512c22.357.0 38.912-5.71700000000001 49.664-17.152 10.923-11.435 16.384-27.136 16.384-47.104.0-21.8453-6.059-37.8027-18.176-47.872-11.947-10.24-27.904-15.36-47.872-15.36H38.248V157.304zM281.82 189.56C265.777 189.56 251.697 186.744 239.58 181.112 227.463 175.48 217.991 167.373 211.164 156.792 204.508 146.211 201.18 133.581 201.18 118.904S204.508 91.6827 211.164 81.272C217.82 70.6907 227.207 62.584 239.324 56.952c12.117-5.8027 26.283-8.704 42.496-8.704 16.213.0 30.379 2.816 42.496 8.448C336.433 62.328 345.82 70.4347 352.476 81.016 359.132 91.4267 362.46 104.056 362.46 118.904 362.46 133.411 359.132 145.955 352.476 156.536s-16.043 18.773-28.16 24.576C312.369 186.744 298.204 189.56 281.82 189.56zm0-28.16c13.824.0 24.661-3.84 32.512-11.52s11.776-18.005 11.776-30.976C326.108 105.763 322.183 95.4373 314.332 87.928 306.652 80.248 295.815 76.408 281.82 76.408c-13.824.0-24.661 3.84-32.512 11.52C241.628 95.608 237.788 105.933 237.788 118.904S241.628 142.2 249.308 149.88C257.159 157.56 267.996 161.4 281.82 161.4zM384.068 187V.375992H420.42V110.2l17.152-15.36L490.82 50.808h46.336l-64.768 53.504L539.46 187H494.148l-38.656-48.64L446.02 125.56l-25.6 20.736V187H384.068zm227.244 2.56c-22.699.0-40.107-4.096-52.224-12.288C546.971 169.08 540.485 157.987 539.632 143.992H575.216c1.024 15.36 13.397 23.04 37.12 23.04C622.747 167.032 630.939 165.667 636.912 162.936 642.885 160.035 645.872 155.512 645.872 149.368 645.872 144.76 644.763 141.347 642.544 139.128 640.325 136.739 636.571 134.947 631.28 133.752 625.989 132.557 618.651 131.533 609.264 130.68 593.733 129.144 581.189 127.011 571.632 124.28 562.075 121.379 555.077 117.283 550.64 111.992 546.373 106.701 544.24 99.6187 544.24 90.744 544.24 77.7733 550.128 67.448 561.904 59.768c11.947-7.68 28.501-11.52 49.664-11.52C631.195 48.248 646.811 52.0027 658.416 59.512 670.021 67.0213 676.421 77.688 677.616 91.512H643.056C642.373 84.344 639.131 79.0533 633.328 75.64 627.525 72.2267 620.187 70.52 611.312 70.52 601.925 70.52 594.245 71.9707 588.272 74.872 582.469 77.6027 579.568 81.9547 579.568 87.928 579.568 93.9013 582.469 97.912 588.272 99.96 594.075 102.008 603.547 103.715 616.688 105.08 632.389 106.445 645.019 108.579 654.576 111.48 664.133 114.211 671.045 118.392 675.312 124.024 679.579 129.485 681.712 137.165 681.712 147.064c0 12.8-5.803 23.125-17.408 30.976C652.869 185.72 635.205 189.56 611.312 189.56z" fill="#fff"/></svg></h5><button type=button class="btn btn-link nav-link p-0" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class="nav-link active" href=https://www.xlabs.club/docs/start-here/getting-started/ aria-current=true>Docs</a></li><li class=nav-item><a class=nav-link href=https://www.xlabs.club/showcase/>Showcase</a></li><li class=nav-item><a class=nav-link href=https://www.xlabs.club/blog/>Blog</a></li><li class=nav-item><a target=blank class=nav-link href=https://github.com/gethyas/doks/discussions>Discussions<svg xmlns="http://www.w3.org/2000/svg" class="ms-1 mb-1 icon icon-tabler icon-tabler-external-link" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 6H6A2 2 0 004 8v10a2 2 0 002 2h10a2 2 0 002-2v-6"/><path d="M11 13l9-9"/><path d="M15 4h5v5"/></svg></a></li><li class=nav-item><a target=blank class=nav-link href=https://gethyas.com>Hyas<svg xmlns="http://www.w3.org/2000/svg" class="ms-1 mb-1 icon icon-tabler icon-tabler-external-link" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 6H6A2 2 0 004 8v10a2 2 0 002 2h10a2 2 0 002-2v-6"/><path d="M11 13l9-9"/><path d="M15 4h5v5"/></svg></a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link mx-2 d-none d-lg-block" aria-label="Search website">
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button>
<button id=buttonColorMode class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type=button aria-label="Toggle theme"><svg data-bs-theme-value="dark" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg><svg data-bs-theme-value="light" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class="nav-item d-none d-lg-flex py-1 col-auto"><div class="vr h-100 mx-2 text-muted"></div></li><li class=nav-item><a rel=me class="nav-link social-link" href=https://github.com/gethyas/doks><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li><li class=nav-item><a rel=me class="nav-link social-link" href=https://fosstodon.org/@doks><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-mastodon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18.648 15.254C16.832 17.017 12 16.88 12 16.88a18.262 18.262.0 01-3.288-.256c1.127 1.985 4.12 2.81 8.982 2.475-1.945 2.013-13.598 5.257-13.668-7.636L4 10.309c0-3.036.023-4.115 1.352-5.633C7.023 2.766 12 3.01 12 3.01s4.977-.243 6.648 1.667C19.977 6.195 20 7.274 20 10.31s-.456 4.074-1.352 4.944z"/><path d="M12 11.204V8.278C12 7.02 11.105 6 10 6S8 7.02 8 8.278V13m4-4.722C12 7.02 12.895 6 14 6s2 1.02 2 2.278V13"/></svg><small class="ms-2 visually-hidden">Mastodon</small></a></li><li class=nav-item><a rel=me class="nav-link social-link" href=https://twitter.com/getdoks><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg><small class="ms-2 visually-hidden">Twitter</small></a></li></ul></div></div></div></header></div><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-3d977af6029800a1bd3629ad45cccea2 aria-expanded=false>
平台工程</button><div class=collapse id=section-3d977af6029800a1bd3629ad45cccea2><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/platform/%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84/>总体架构</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/platform/%E7%BB%9F%E4%B8%80%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/>统一身份认证</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/platform/%E5%BC%80%E5%8F%91%E8%80%85%E9%97%A8%E6%88%B7/>开发者门户</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/platform/%E6%99%BA%E8%83%BD%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84/>智能代码重构</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-03eadd6d06506d54fb81026b2f5963c8 aria-expanded=true>
云原生</button><div class="collapse show" id=section-03eadd6d06506d54fb81026b2f5963c8><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/cloud/introduction/>Introduction</a></li><li><a class="docs-link rounded active" href=https://www.xlabs.club/docs/cloud/%E5%9F%BA%E4%BA%8E-envoy-%E7%9A%84%E6%99%BA%E8%83%BD%E8%B7%AF%E7%94%B1%E6%9C%8D%E5%8A%A1/>基于 Envoy 的智能路由服务</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-d52387880e1ea22817a72d3759213819 aria-expanded=false>
Java</button><div class=collapse id=section-d52387880e1ea22817a72d3759213819><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/java/%E4%BB%8E-spring-%E5%88%B0-spring-boot/>从 Spring 到 Spring Boot</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/java/spring-boot-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/>Spring Boot 自定义监控指标</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/java/%E4%BD%BF%E7%94%A8-openrewrite-%E8%BF%9B%E8%A1%8C%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84/>使用 OpenRewrite 进行代码重构</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-71bb54bbe3fa573fa0200737b4296024 aria-expanded=false>
Start Here</button><div class=collapse id=section-71bb54bbe3fa573fa0200737b4296024><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/start-here/getting-started/>Getting Started</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/start-here/environmental-impact/>Environmental Impact</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/start-here/upgrade-to-v1/>Upgrade to v1</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-bbc9105ee8508ce6e083a589a351e83a aria-expanded=false>
Basics</button><div class=collapse id=section-bbc9105ee8508ce6e083a589a351e83a><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/basics/project-structure/>Project Structure</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/basics/authoring-content/>Authoring Content</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/basics/shortcodes/>Shortcodes</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/basics/navigation/>Navigation</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-7efb9866cc6ad242061889b460ca0bfd aria-expanded=false>
Built-ins</button><div class=collapse id=section-7efb9866cc6ad242061889b460ca0bfd><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/built-ins/math/>Mathematical Expressions</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/built-ins/diagrams/>Diagrams</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/built-ins/code-blocks/>Code Blocks</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-0153a1e369e543364edb1e75ceff1173 aria-expanded=false>
Recipes</button><div class=collapse id=section-0153a1e369e543364edb1e75ceff1173><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/recipes/deploy/>Deploy</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/recipes/analytics/>Analytics</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/recipes/cms/>CMS</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/recipes/docsearch/>DocSearch</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/recipes/versioning/>Versioning</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-45389ee90014e0938cb09409b9a8794d aria-expanded=false>
Guides</button><div class=collapse id=section-45389ee90014e0938cb09409b9a8794d><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/tldr/>TL;DR</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/customization/>Customizing Doks</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/styles/>Styles</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/scripts/>Scripts</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/layouts/>Layouts</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/i18n/>Internationalization (i18n)</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/guides/%E4%BB%8E-1024-%E5%88%B0-512/>从 1024 到 512</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-63d5049791d9d79d86e9a108b0a999ca aria-expanded=false>
Reference</button><div class=collapse id=section-63d5049791d9d79d86e9a108b0a999ca><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/reference/configuration/>Configuration</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/reference/frontmatter/>Frontmatter</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/reference/markdown-basic-syntax/>Markdown Basic Syntax</a></li><li><a class="docs-link rounded" href=https://www.xlabs.club/docs/reference/markdown-extended-syntax/>Markdown Extended Syntax</a></li></ul></div></li></ul></nav></div><div class="col container-fw d-lg-flex flex-lg-row justify-content-center mx-auto"><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=toc><ul><li><a href=#核心需求>核心需求</a></li><li><a href=#整体架构>整体架构</a></li><li><a href=#方案对比>方案对比</a></li><li><a href=#功能实现方案>功能实现方案</a><ul><li><a href=#服务注册>服务注册</a></li><li><a href=#服务发现>服务发现</a></li><li><a href=#路由和负载均衡规则>路由和负载均衡规则</a></li><li><a href=#envoy-配置下发和更新>Envoy 配置下发和更新</a></li><li><a href=#使用限制>使用限制</a></li></ul></li><li><a href=#nacos-服务端部署>Nacos 服务端部署</a></li></ul></nav></div><div class=feedback-links><h3>Give Feedback</h3><ul class=list-unstyled><li><a href=https://github.com/gethyas/doks/issues/new/choose>Create an issue</a></li><li><a href="https://github.com/gethyas/doks/discussions/new?category=ideas">Share an idea</a></li><li><a href="https://github.com/gethyas/doks/discussions/new?category=q-a">Ask a question</a></li></ul></div><script async src="https://cdn.carbonads.com/carbon.js?serve=CESIT5QY&placement=getdoksorg" id=_carbonads_js></script></nav><main class="docs-content col-lg-16 col-xl-9 mx-xl-auto"><h1>基于 Envoy 的智能路由服务</h1><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>On this page</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#核心需求>核心需求</a></li><li><a href=#整体架构>整体架构</a></li><li><a href=#方案对比>方案对比</a></li><li><a href=#功能实现方案>功能实现方案</a><ul><li><a href=#服务注册>服务注册</a></li><li><a href=#服务发现>服务发现</a></li><li><a href=#路由和负载均衡规则>路由和负载均衡规则</a></li><li><a href=#envoy-配置下发和更新>Envoy 配置下发和更新</a></li><li><a href=#使用限制>使用限制</a></li></ul></li><li><a href=#nacos-服务端部署>Nacos 服务端部署</a></li></ul></nav></div></details></nav><p>基于 Envoy + Java Agent 的智能路由服务实现方案介绍。</p><h2 id=核心需求>核心需求<a href=#核心需求 class=anchor aria-hidden=true>#</a></h2><ol><li>服务自动注册和发现，通过 Service Name 直接调用服务。当然基本的负载均衡策略、熔断降级限流等功能也要支持。</li><li>公司约定的路由策略，支持按照租户路由到特定环境的服务，比如 VIP、Gray、Sandbox 等。</li><li>多集群通信，同云内新老 K8S 集群路由打通，可通过 POD IP 互相通信。</li><li>跨云通信，支持通过 VPN 或代理，从专属云访问公有云服务。</li></ol><h2 id=整体架构>整体架构<a href=#整体架构 class=anchor aria-hidden=true>#</a></h2><p>智能路由服务从逻辑上分为数据平面和控制平面，主要包含以下组件。</p><ul><li>Nacos：服务注册中心，配置中心。</li><li>XDS Server：对接服务注册中心、配置中心，实现 CDS、LDS、RDS 协议将集群、服务、路由、灰度租户等配置下发到 Envoy。</li><li>Envoy + WASM Plugin：通过 Envoy 代理流量，自定义 WASM 插件实现按照租户、用户路由到不同服务，实现自定义负载均衡策略。</li><li>Java Agent：增强 Java 应用 Http Client，拦截 OkHttp、Apache Http Client、RestTemplate、OpenFeign 等客户端调用，将流量重定向到 Envoy，Envoy 再根据服务名路由到真实的 Pod，实现服务发现和灾备切换。</li><li>Nacos Service CRD：自定义 Nacos Service CRD，将 Service 注册到 Nacos 中作为一个永久实例，解决跨云、跨集群服务调用。比如跨云情况下注册的是一个公网地址或 VPN 可通的地址。</li></ul><div class="mermaid text-center">C4Context
title 基于 Envoy + Java Agent 的智能路由服务
Enterprise_Boundary(dp, "Data Plane") {
Container(appA, "Application A", "Java,Agent", "Agent 拦截客户端重定向到 Envoy")
Container(envoy, "Envoy Proxy", "Envoy,WASM", "代理所有入口流量<br>基于租户、服务负载均衡")
Container(appB, "Application B", "Java,Agent", "应用注册到服务中心")
Rel(appA, envoy, "request by name", "http")
Rel(envoy, appB, "http proxy & lb", "http")
        UpdateRelStyle(appA, envoy, $offsetX="-40",$offsetY="-40")
UpdateRelStyle(envoy, appB, $offsetX="-40",$offsetY="-40")
}
Enterprise_Boundary(cp, "Control Plane") {
System(registry, "服务注册", "服务注册，服务元数据<br>配置管理，双向刷新")
Container(xdsServer, "控制面板", "Java,Grpc", "对接服务注册中心配置中心<br>实现 XDS 协议将配置下发到 Envoy")
System(config, "配置管理", "服务注册，服务元数据<br>配置管理，双向刷新")
Rel_L(xdsServer, registry, "实时获取服务实例")
Rel_R(xdsServer, config, "实时配置刷新")
UpdateRelStyle(xdsServer, registry, $offsetX="-40",$offsetY="-20")
UpdateRelStyle(xdsServer, config, $offsetX="-40",$offsetY="-20")
}
Rel_U(xdsServer,envoy,"通过 XDS 实现配置动态下发","grpc")
Rel_D(appA, registry, "服务注册，配置刷新")
Rel_D(appB, config, "服务注册，配置刷新")
UpdateLayoutConfig($c4ShapeInRow="3", $c4BoundaryInRow="1")</div><h2 id=方案对比>方案对比<a href=#方案对比 class=anchor aria-hidden=true>#</a></h2><p>此方案原始的目标有几个：</p><ol><li>语言无关，可以不绑定 Java。目前看来这是个伪需求。</li><li>实现类似 Istio Ambient Mesh，剔除 Egress 流量代理，每个 Node 部署一个 Envoy Proxy，减少 Sidecar 资源开销。目前随着 Istio Ambient Mesh 成熟，这个优点反而也没有了。</li></ol><p>对比 K8S 体系、Spring Cloud 体系，此方案优点：</p><ol><li>各服务实际上只需要注入服务中心，服务发现和负载均衡交给 Agent 和 Envoy，对于老的 Spring 项目也能直接使用，相对 Spring Cloud 轻量一些。</li><li>不需要引入 Istio 也能支持跨云、跨集群访问场景，Istio 相对还是比较重。</li></ol><p>此方案缺点：</p><ol><li>本质上还是 Proxy 模式，Proxy 的所有缺点他都绕不过，比如：性能损耗、Http Keepalive 和 reset 响应。</li><li>对服务和配置实时刷新，要比 K8S、Spring Cloud 略微延迟，对高并发场景难免有中断。</li><li>单点故障影响范围太大，以及 Proxy 任何配置性错误都是致命的。</li></ol><p>综上，随着 Istio Ambient Mesh 以及基于 eBPF 的 Cilium Mesh 的成熟，这个方案可能逐渐退出历史舞台。那么，使用 Spring Cloud 全家桶快速启动先让业务用起来，反而成了一个最简单的方案。</p><h2 id=功能实现方案>功能实现方案<a href=#功能实现方案 class=anchor aria-hidden=true>#</a></h2><p>主要功能实现方式如下。</p><h3 id=服务注册>服务注册<a href=#服务注册 class=anchor aria-hidden=true>#</a></h3><p>服务通过 nacos support 或 nacos starter 注册到服务中心，关注下 Nacos 数据模型：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><pre tabindex=0><code class=language-tree data-lang=tree>namespace
    - group
        - service
            - cluster
                - instance: ip,port,metadata</code></pre></figure></div><p>namespace 和 group 的设计目的是为了实现隔离。</p><ol><li>同 service 下 instance 唯一标记：ip + port + cluster。metadata 不作为唯一性标记。</li><li>同 namespace 不同 group 下 service 可以完全相同。</li></ol><table><thead><tr><th>Nacos 模型</th><th>开源原生默认值</th><th>我们方案</th></tr></thead><tbody><tr><td>namespace</td><td>租户/环境 ，默认 public</td><td>固定自定义值</td></tr><tr><td>group</td><td>组织/虚拟分组，默认 DEFAULT</td><td>默认 DEFAULT，如果某个组确认自己的服务不给组用可自定义 group</td></tr><tr><td>service</td><td>spring.application.name</td><td>默认也是 spring.application.name，子模块名</td></tr><tr><td>cluster</td><td>虚拟，a k8s cluster/ a AZ</td><td>线上发布系统的“环境”英文名，实际是 k8s 的 namespace</td></tr><tr><td>instance</td><td>一个 Java 应用，一个 jar 或一个 war 服务</td><td>一个 jar 或一个 war 服务</td></tr></tbody></table><p>注册实例信息约束：</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>serviceName: appName.modeleName 应用的子模块名，目前的字符和长度限制都能满足要求
</span></span></span><span class=line><span class=cl><span class=go>clusterName: 发布系统定义的“环境”英文名
</span></span></span><span class=line><span class=cl><span class=go>ip: pod ip
</span></span></span><span class=line><span class=cl><span class=go>port: container port
</span></span></span><span class=line><span class=cl><span class=go>enabled： true or false 用于主动控制上下线，下线保留实例不承载流量
</span></span></span><span class=line><span class=cl><span class=go>weight：权重
</span></span></span><span class=line><span class=cl><span class=go>metadata：
</span></span></span><span class=line><span class=cl><span class=go>    - contextPath： 推荐等同子模块名，要求必须有且不能随意变更，可以是根目录
</span></span></span><span class=line><span class=cl><span class=go>    - preserved.register.source: 官方自动加，如 Spring Cloud、Dubbo。
</span></span></span><span class=line><span class=cl><span class=go>    - secure：官方开源客户端自动加 boolean 值，标记 http or https 协议
</span></span></span><span class=line><span class=cl><span class=go>    - protocol：通信协议，http/grpc/dubbo
</span></span></span><span class=line><span class=cl><span class=go>    - version：版本标记，后续扩展路由策略支持多版本或限定版本。
</span></span></span><span class=line><span class=cl><span class=go>    - runtime：k8s info、node info。
</span></span></span></code></pre></div></figure></div><p>对于专属云访问公有云，目前是通过 VPN 代理方式，那么在专属云访问公有云时，如何通过 Service 名字映射到公有云服务呢。
我们会在专属云内，手动（优化为自定义 K8S CRD，联动 GitOps 自动部署）在 Nacos 中增加一个永久性实例（关于永久性实例和临时实例的说明请参考官方文档），只是这个实例的 IP 不是 POD IP，是通过 VPN 可通的 IP。</p><h3 id=服务发现>服务发现<a href=#服务发现 class=anchor aria-hidden=true>#</a></h3><p>调用方可使用 OkHttp、RestTemplate、OpenFeign 等客户端，直接使用服务名调用，比如：<code>GET http://user-service/users</code>。</p><p>服务发现和负载均衡策略，其实依赖三个组件：XDS Server、Envoy + WASM、Java Agent。</p><p>基本实现步骤：</p><ol><li>XDS Server 从 Nacos 实时获取最新的服务和实例列表，从配置中心获取服务灰度列表，通过 ADS 协议实时下发到 Envoy。</li><li>我们为 Envoy 定制了一个 WASM Plugin，这个 Plugin 支持通过租户路由到 Gray、VIP、Sandbox 等不同环境，Envoy 通过环境标记负载到真实的 POD 上。</li><li>Java Agent 增强 OkHttp 增加自定义 intercept，拦截服务名重定向到 Envoy，Envoy 根据服务名、路径、Header 路由到真实的后端服务。</li><li>我们的 RestTemplate、OpenFeign 客户端做了定制，底层连接器都切换到了 OkHttp。</li><li>客户端调用时，Header 中增加租户信息。</li><li>客户端调用时不需要关心服务的 contextPath，Envoy 会自动追加 contextPath。</li></ol><h3 id=路由和负载均衡规则>路由和负载均衡规则<a href=#路由和负载均衡规则 class=anchor aria-hidden=true>#</a></h3><p>运行环境定义：
Gray: foneshare-gray 用于常规发布的灰度过程；承载 QA 专用在线测试租户
Stage: foneshare-stage 用于大版本发布的灰度过程，承载 QA 专用在线测试租户、必要的真实租户
Urgent: foneshare-urgent 用于解决线上 vip、svip 面临的紧急 bug, 承载 bug 相关的 vip、svip 租户
Normal: foneshare、foneshare01、foneshare02、foneshare03、foneshare04 承载 vip 之外的租户
VIP: foneshare-vip 承载 vip 的租户
SVIP: 一个 foneshare-svip 承载多个 svip 租户
SSVIP: 一个环境承担一个租户，如 foneshare-yqsl 承载 ssvip 租户
Sandbox：所有以 <code>_sandbox</code> 结尾的租户都会路由到 Sandbox 环境。</p><p>环境路由优先级从高到低：</p><p>SSVIP > Gray > Urgent > Stage > SVIP > VIP > Sandbox > Normal</p><p>对于同一租户，既配置在 vip 的灰度名单，同时又配置到 gray 的灰度名单，实际路由时走哪个环境：</p><p>P1，最高优先级，gray、urgent、yqsl 等专属环境，tenantId 匹配任意环境就会返回；
P2，第 2 优先级，stage；
P3，第 3 优先级，svip；
P4，第 4 优先级，vip；
P5，第 5 优先级，sandbox；
P6，默认 normal，上述环境均未匹配到后，路由到 normal 环境。</p><p>按照上述顺序的原则，如一家租户既配置在 vip 同时又配置在 gray，实际会路由到 gray 环境。
注意：</p><ol><li>这里<code>路由到 gray</code>是指 gray 中存在对应的服务，如果 gray 中不存在服务，会按匹配到的优先级（vip）继续找，直到找到可用的服务。</li><li>命中条件：租户在这个环境的这个服务名单里（租户+服务唯一确定）。</li><li>沙箱用户比较特殊，是 EA 以 <code>_sandbox</code> 结尾。</li></ol><h3 id=envoy-配置下发和更新>Envoy 配置下发和更新<a href=#envoy-配置下发和更新 class=anchor aria-hidden=true>#</a></h3><p>Envoy 通过文件系统或查询管理服务器发现其各种动态资源。这些发现服务及其相应的 API 统称为 xDS。</p><p>我们的控制面 XDS Server 只实现了聚合发现服务（ADS），通过 ADS 使用单个流推送 CDS、EDS 和 RDS 资源，实现无中断的更新。</p><p>XDS Server 缓存了各个 Envoy 的 grpc connection，同时响应 Nacos 和配置中心的更新事件，收到更新后再通过 grpc 推送到各个 Envoy 终端。</p><h3 id=使用限制>使用限制<a href=#使用限制 class=anchor aria-hidden=true>#</a></h3><ol><li>请求 Header 必须要包含 x-fs-ea 或 x-fs-ei 参数（推荐 x-fs-ea），否则无法支持按租户路由。</li><li>同一个服务在同一个环境，发布流程中的 contextPath 必须一致，因为是按环境类型统一路由只能有一个 contextPath。</li><li>配置文件变更需要 30s 后才能生效，这取决了 CMS 配置系统拉取方式。</li><li>新增加服务无法立即感知到（是新的服务，不是服务实例，实例能即时感知），我们是 10 分钟扫描一次服务，判断有无服务变更。</li></ol><h2 id=nacos-服务端部署>Nacos 服务端部署<a href=#nacos-服务端部署 class=anchor aria-hidden=true>#</a></h2><p>部署形态：</p><ol><li>公有云一套，承接公有云新老集群。</li><li>每个专属云有独立的一套。</li></ol><p>注意事项：</p><ol><li>Nacos 需要放开 http（8848）和 grcp（9848、9849）端口。</li><li>认证：使用用户名密码模式。不同组创建独立的用户名密码，单独授权。默认的用户<code>nacos</code>不要用且权限不足。</li><li>连接时配置的 namespace 实际是 namespace id，可以考虑创建 namespace 时主动设置 namespace id 等同于 namespace name，便于定位，误删或迁移的时候能保证 ID 不变。</li></ol><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"><div class=edit-page><a href=https://github.com/gethyas/getdoks.org/blob/main/content//docs/cloud/service-mesh-envoy.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></div></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/docs/java/spring-boot-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/ class="stretched-link text-reset text-decoration-none">Spring Boot 自定义监控指标</a></div></div></div><div class=m-2></div><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/docs/basics/project-structure/ class="stretched-link text-reset text-decoration-none">Project Structure</a></div><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div><span id=docsearch-lvl0 hidden>云原生</span></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=https://gethyas.com/privacy/>Privacy Policy</a></li><li class=list-inline-item><a class=text-muted href=https://gethyas.com/terms/>Terms of Service</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item>Brought to you by <a class=text-muted href=https://gethyas.com/>Hyas</a></li></ul></div></div></div></footer><script async src=/js/bootstrap.7424592a74f2abbd0e29e7fc0656f4c7dc9630431d965a120786ab31209b1d3c.js integrity="sha256-dCRZKnTyq70OKef8Blb0x9yWMEMdlloSB4arMSCbHTw="></script><script async src=/js/app.47b84f3b640408af6efe7bf4add1a36f5b9c6227fbae7b8bcdf0c9ce42fefc54.js integrity="sha256-R7hPO2QECK9u/nv0rdGjb1ucYif7rnuLzfDJzkL+/FQ="></script><script async src=/js/docsearch.eea9eb8dbc5909d5950b8b65434f0ac066dc70eae0ac4f16d45bca692f1029f4.js integrity="sha256-7qnrjbxZCdWVC4tlQ08KwGbccOrgrE8W1FvKaS8QKfQ="></script></body></html>